{% extends "dashboard/base.html" %}
{% block content %}
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
<div class="container-fluid px-4">
    <ol class="breadcrumb mt-3 mb-4">
        <li class="breadcrumb-item"><a href="{% url 'dashboard' %}">Dashboard</a></li>
        <li class="breadcrumb-item active">News List</li>
    </ol>
    <div class="row">
        <div class="card rounded-3 mt-4">
            <div class="card-header d-flex justify-content-between align-items-center flex-wrap">
                <h5 class="mb-0">ðŸ“– News Lists</h5>
                <div class="text-black py-2 px-4 rounded-pill mt-2 mt-md-0">
                        <a href="{% url 'news_app:generator' %}" class="btn btn-success text-white fw-bold">
                                + Buat Berita Baru 
                            </a>
                    </div>
            </div>
            <div class="card-body">
                {% comment %} <div class="row"> {% endcomment %}
                    {% if page_obj %}
                        <table id="newsTable" class="table table-bordered table-striped">
                            <thead>
                                <tr>
                                    <th class="px-4 py-2 text-left">No.</th>
                                    <th class="px-4 py-2 text-left">Judul</th>
                                    <th class="px-4 py-2 text-left">Kategori</th>
                                    <th class="px-4 py-2 text-left">Image</th>
                                    <th class="px-4 py-2 text-left">Kontributor</th>
                                    <th class="px-4 py-2 text-left">Tanggal</th>
                                    <th class="px-4 py-2 text-left">Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for article in page_obj %}
                                    <tr>
                                        <td>{{ forloop.counter0|add:page_obj.start_index }}</td>
                                        <td class="border-t px-4 py-2 text-gray-800 font-medium">
                                            {{ article.judul|default:"Judul Berita Tanpa Nama"|safe }}
                                        </td>
                                        <td class="border-t px-4 py-2 text-gray-500">
                                            {{ article.get_kategori_display }}
                                        </td>
                                        <td class="border-t px-4 py-2 text-gray-800 font-medium">
                                            {% if article.image %}
                                                <img src="{{ article.image.url }}" alt="Gambar Berita" class="img-fluid w-25 mx-auto">
                                            {% endif %}
                                        </td>
                                        <td class="border-t px-4 py-2">
                                            <span class="badge bg-success">Penulis: {{ article.creator.username|default:"Tidak Diketahui" }}</span>
                                            <span class="badge bg-info">Editor: {{ article.editor.username|default:" - " }}</span>
                                            
                                            
                                        </td>
                                        <td class="border-t px-4 py-2 text-gray-500">
                                            <span class="badge bg-success">Created: {{ article.created_at|date:"d M Y" }}</span>
                                            <span class="badge bg-info">Published: {{ article.diterbitkan_pada|date:"d M Y" |default:" - " }}</span>
                                            
                                        </td>
                                        <td class="border-t px-4 py-2">
                                            <div class="flex space-x-2 dt-actions d-flex">
                                                <a href="{% url 'news_app:detail' article.id %}" class="btn btn-info btn-sm inline-block mx-1 text-sm font-medium rounded-full text-white bg-gray-200 hover:bg-gray-300 transition-colors">
                                                    Baca
                                                </a>
                                                <a href="{% url 'news_app:edit' article.id %}" class="btn btn-primary btn-sm text-sm mx-1 font-medium rounded-full text-white bg-blue-600 hover:bg-blue-700 transition-colors">
                                                    Edit
                                                </a>
                                                <a href="{% url 'news_app:delete' article.id %}" class="btn btn-danger btn-sm text-sm mx-1 font-medium rounded-full text-white bg-red-600 hover:bg-red-700 transition-colors">
                                                    Delete
                                                </a>
                                            </div>
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    {% else %}
                        <p class="text-center text-gray-500 py-4">Belum ada berita yang dihasilkan.</p>
                    {% endif %}
                {% comment %} </div> {% endcomment %}
                
                
            </div>
        </div>
        
    </div>

</div>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
<script>
$(document).ready(function () {
    const table = $('#newsTable').DataTable({
        responsive: true,
        order: [[0, 'asc']],
        language: {
            search: "Cari:",
            lengthMenu: "Tampilkan _MENU_ entri",
            info: "Menampilkan _START_ sampai _END_ dari _TOTAL_",
            paginate: {
                previous: "Sebelumnya", next: "Berikutnya"
            },
            zeroRecords: "Data tidak ditemukan"
        }
    });

    $('#newsTable tbody').on('click', '.btnDelete', function () {
        const id = $(this).data('id');
        if (!confirm('Yakin ingin menghapus data ini?')) return;

        $.ajax({
            url: `delete/${id}/`,
            method: 'POST',
            headers: { "X-CSRFToken": "{{ csrf_token }}" },
            success: function (res) {
                alert(res.message);
                table.row($(this).parents('tr')).remove().draw();
                location.reload();
            },
            error: function () {
                alert("Gagal menghapus data.");
            }
        });
    });
});
</script>
{% comment %} {{div|safe}}     {% endcomment %}
{% endblock content %}